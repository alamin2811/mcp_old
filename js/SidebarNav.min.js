(function($) {
    "use strict";
    $.fn.SidebarNav = function(options) {
        var defaults = $.extend({
            animationSpeed: 300 // Animation speed
        }, options);
        return this.each(function() {
            $(this).on('click', 'li a', function(e) {
                var checkElement = $(this).next();
                if (checkElement.is('.treeview-menu') && checkElement.is(':visible')) {
                    checkElement.slideUp(defaults.animationSpeed, function() {
                        checkElement.removeClass('menu-open');
                    });
                    checkElement.parent("li").removeClass("active");
                }
                //If the menu is not visible
                else if ((checkElement.is('.treeview-menu')) && (!checkElement.is(':visible'))) {
                    //Get the parent menu
                    var parent = $(this).parents('ul').first(),
                        //Close all open menus within the parent
                        ul = parent.find('ul:visible').slideUp(defaults.animationSpeed);
                    //Remove the menu-open class from the parent
                    ul.removeClass('menu-open');
                    //Get the parent li
                    var parent_li = $(this).parent("li");
                    //Open the target menu and add the menu-open class
                    checkElement.slideDown(defaults.animationSpeed, function() {
                        //Add the class active to the parent li
                        checkElement.addClass('menu-open');
                        parent.find('li.active').removeClass('active');
                        parent_li.addClass('active');
                    })
                }
                //if this isn't a link, prevent the page from being redirected
                if (checkElement.is('.treeview-menu')) {
                    e.preventDefault();
                }
            })
        })
    };
}(jQuery));